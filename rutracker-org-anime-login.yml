---
id: rutracker-org-anime-login
name: RuTracker.org (Anime) [Login]
description: "RuTracker.org - Custom indexer with anime episode parsing for Sonarr (username/password)"
language: ru-RU
type: semi-private
encoding: windows-1251
links:
  - https://rutracker.org/

caps:
  categorymappings:
    - {id: 33, cat: TV/Anime, desc: "Аниме"}
    - {id: 1106, cat: TV/Anime, desc: "Онгоинги (HD Video)"}
    - {id: 1105, cat: TV/Anime, desc: "Аниме (HD Video)"}
    - {id: 599, cat: TV/Anime, desc: "Аниме (DVD)"}
    - {id: 1389, cat: TV/Anime, desc: "Аниме (основной подраздел)"}
    - {id: 1391, cat: TV/Anime, desc: "Аниме (плеерный подраздел)"}
    - {id: 2491, cat: TV/Anime, desc: "Аниме (QC подраздел)"}
    - {id: 2544, cat: TV/Anime, desc: "Ван-Пис"}
    - {id: 1642, cat: TV/Anime, desc: "Гандам"}
    - {id: 1390, cat: TV/Anime, desc: "Наруто"}
    - {id: 404, cat: TV/Anime, desc: "Покемоны"}
    - {id: 893, cat: TV/Anime, desc: "Японские мультфильмы"}

  modes:
    search: [q]
    tv-search: [q, season, ep]
  allowrawsearch: true

settings:
  - name: username
    type: text
    label: Username
  - name: password
    type: password
    label: Password
  - name: stripcyrillic
    type: checkbox
    label: Strip Cyrillic Letters
    default: false
  - name: addrussiantotitle
    type: checkbox
    label: Add RUS to end of all titles
    default: false
  - name: sort
    type: select
    label: Sort requested from site
    default: 1
    options:
      1: created
      10: seeders
      7: size
      2: title
  - name: type
    type: select
    label: Order requested from site
    default: 2
    options:
      2: desc
      1: asc

login:
  path: forum/login.php
  method: post
  inputs:
    login_username: "{{ .Config.username }}"
    login_password: "{{ .Config.password }}"
    login: "Login"
    redirect: "index.php"
  error:
    - selector: h4.warnColor1
    - selector: div.msg-main
  test:
    path: forum/index.php
    selector: "#logged-in-username"

search:
  paths:
    - path: forum/tracker.php
  inputs:
    $raw: "{{ if .Categories }}{{ range .Categories }}f[]={{.}}&{{end}}{{ else }}f[]=-1{{ end }}"
    o: "{{ .Config.sort }}"
    s: "{{ .Config.type }}"
    tm: -1
    sns: -1
    nm: "{{ .Keywords }}"

  keywordsfilters:
    - name: diacritics
      args: replace
    - name: re_replace
      args: ["(?i)\\bS0*(\\d+)E0*(\\d+)\\b", ""]
    - name: re_replace
      args: ["(?i)\\bS0*(\\d+)\\b", ""]
    - name: re_replace
      args: ["(?i)\\bE0*(\\d+)\\b", ""]

  rows:
    selector: tr.tCenter.hl-tr:has(a.tr-dl)

  fields:
    category:
      selector: a.gen[href*="tracker.php?f="]
      attribute: href
      filters:
        - name: querystring
          args: f
    title:
      selector: a.tLink
      filters:
        # Minimal processing for LLM proxy - only parse seasons/episodes, preserve all other info
        # Normalize Unicode dash characters to standard dash
        - name: re_replace
          args: ["\\p{Pd}", "-"]
        # Anime: ТВ-(number) -> S(number) - parse season from ТВ-X format
        - name: re_replace
          args: ["\\(ТВ[-]*(\\d+)\\)", "(S$1)"]
        - name: re_replace
          args: ["ТВ[-]*(\\d+)", "S$1"]
        # Anime: [number из number] -> [E(number) of (number)] - parse episode range
        # Support formats: [13 из 13], [1-13 из 24], [13+1 из 13]
        - name: re_replace
          args: ["\\[(\\d+(?:-\\d+)?(?:\\+\\d+)?)\\s+из\\s+(\\d+(?:\\+\\d+)?)\\]", "[E$1 of $2]"]
        # Russian Season/Episode patterns (for non-anime TV series)
        # Сезон X: Серии Y из Z -> SXE$Y of $Z
        - name: re_replace
          args: ["Сезон\\s*[:]*\\s+(\\d+).+(?:Серии|Эпизод|Выпуски)+\\s*[:]*\\s+(\\d+(?:-\\d+)?)\\s*из\\s*([\\w?])", "S$1E$2 of $3"]
        # Сезон X: Серии Y -> SXE$Y
        - name: re_replace
          args: ["Сезон\\s*[:]*\\s+(\\d+).+(?:Серии|Эпизод|Выпуски)+\\s*[:]*\\s+(\\d+(?:-\\d+)?)", "S$1E$2"]
        # Сезон X -> S$X
        - name: re_replace
          args: ["Сезон\\s*[:]*\\s+(\\d+(?:-\\d+)?)", "S$1"]
        # Серии X из Y -> E$X of $Y
        - name: re_replace
          args: ["(?:Серии|Эпизод|Выпуски)+\\s*[:]*\\s+(\\d+(?:-\\d+)?)\\s*из\\s*([\\w?])", "E$1 of $2"]
        # Серии X -> E$X
        - name: re_replace
          args: ["(?:Серии|Эпизод|Выпуски)+\\s*[:]*\\s+(\\d+(?:-\\d+)?)", "E$1"]
        # Replace multiple spaces with single space (basic cleanup)
        - name: re_replace
          args: ["\\s+", " "]
        # Add [RuTracker] prefix if not present (for identification)
        - name: re_replace
          args: ["^(?!\\[)", "[RuTracker] "]
    details:
      selector: a.tLink
      attribute: href
    download:
      selector: a.tr-dl
      attribute: href
    size:
      selector: td.tor-size
      attribute: data-ts_text
    seeders:
      selector: td b.seedmed
      optional: true
      default: 0
      filters:
        - name: regexp
          args: "([0-9]+)"
    leechers:
      selector: td.leechmed
      optional: true
      default: 0
      filters:
        - name: regexp
          args: "([0-9]+)"
    grabs:
      selector: td:nth-child(9)
      optional: true
      default: 0
      filters:
        - name: regexp
          args: "([0-9]+)"
    date:
      selector: td:last-child
      filters:
        - name: append
          args: " +03:00"
        - name: dateparse
          args: "2-Jan-06 15:04 -07:00"
    downloadvolumefactor:
      case:
        img[src*="gold"]: 0
        img[src*="silver"]: 0.5
        "*": 1
    uploadvolumefactor:
      text: 1

# КРИТИЧЕСКИ ВАЖНО: Эта секция преобразует поля seeders/leechers в Torznab формат для Sonarr
torznabResponse:
  item:
    attributes:
      seeders:
        path: seeders
        value: number
      leechers:
        path: leechers
        value: number
      grabs:
        path: grabs
        value: number

